---
layout: post
title: Untrusted Gateways - Open wireless networks
date: '2007-11-10T03:44:00.000+02:00'
author: Roee Hay
tags: 
modified_time: '2007-11-21T12:20:10.873+02:00'
---

<div style="text-align: justify;">One should always ask himself if the wireless gateway he uses is trustworthy.<br /><br />Depict yourself the following situation:<br /><br />You are sitting in a coffee shop, seeking for wireless networks. what are you gonna do next? connect to a network which SSID's is similar to the coffee shop's name, or if none exists, connect to the first open network you find.<br /><br />If the coffee shop doesn't have a wireless network, it gives a malicious user an opportunity to run his own network, on behalf of the coffee shop to attract clients. Otherwise, he will have to spoof the legitimate access-point's MAC, and race for new clients.<br /><br />Everyone knows that open wireless networks are prone to sniffing, but most people are unaware of the fact that active attacks could take place as well, and it is especially easy if the malicious user controls the gateway.<br /><br />This <a href="http://vimeo.com/379554">video</a> demonstrates how an exe file is injected transparently into an innocent HTTP session.<br /><br />What happens behind the scenes is the use of a transparent proxy I built, which terminates HTTP traffic, and searches for exe download patterns (<span style="font-family:Courier;">Content-Type:\s+application/octet-stream</span> to be exact). When it matches an exe pattern, it replaces the response with a malicious binary. The proxy runs on the gateway, which is fixed with an iptables rule (<span style="font-family:Courier;">iptables -t nat -A PREROUTING -i [interface] -p tcp --dport 80 -j REDIRECT --to-ports [proxy interface]</span>)  that forwards all transit HTTP via the proxy.<br /><br />By the use of PKI you can ensure you pass your malicious gateway without data mutation.<br />So consider yourself one of the following countermeasures:<br /><br />1) Download binaries from SSL sites only (and verify the certificate!)<br />2) Use an SSL proxy (and again verify the certificate)<br />3) Tunnel traffic through a VPN<br />4) Tunnel traffic through SSH<br />5) Download signed binaries, and verify the digital signature.<br /><br /></div>
